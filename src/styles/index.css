/* src/styles/index.css */
@tailwind base;
@tailwind components;
@tailwind utilities;

/* Define base layer styles */
@layer base {
  /* Apply base font stack, background, text color, and smoothing */
  body {
    @apply bg-canvas font-sans text-gray-900 antialiased; /* Slightly darker base text */
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji';
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  /* Define consistent focus-visible styles using primary color */
  *:focus-visible {
    /* Use a slightly softer, inset ring for better integration */
    @apply outline-none ring-1 ring-primary/70 ring-offset-1 ring-offset-canvas;
  }

  /* Remove default outline on buttons when focused (use focus-visible instead) */
  button:focus {
    outline: none;
  }

  /* Define CSS variable for monospace font stack for CodeMirror */
  :root {
    --font-mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  }
}

/* Define component layer styles */
@layer components {
  /* Custom refined scrollbar styling */
  .styled-scrollbar::-webkit-scrollbar {
    width: 6px; /* Thinner scrollbar */
    height: 6px;
  }

  .styled-scrollbar::-webkit-scrollbar-track {
    background-color: transparent; /* Fully transparent track */
  }

  .styled-scrollbar::-webkit-scrollbar-thumb {
    @apply bg-gray-300/50 rounded-full border-[1px] border-solid border-transparent; /* Subtle border for padding */
    background-clip: padding-box; /* Clip background to padding box */
    transition: background-color 0.15s ease-out;
  }

  /* Darker scrollbar thumb on hover - more subtle */
  .styled-scrollbar:hover::-webkit-scrollbar-thumb {
    @apply bg-gray-400/60;
  }
  .styled-scrollbar::-webkit-scrollbar-thumb:hover {
    @apply bg-gray-400/70;
  }


  /* --- react-day-picker style overrides (Tailwind-based) --- */

  /* Popper container for DayPicker (will be applied via Dropdown contentClassName) */
  .day-picker-dropdown {
    @apply rounded-lg border border-black/5 shadow-strong overflow-hidden p-1 z-50;
    @apply bg-glass-100 backdrop-blur-md; /* Use configured glass effect */
  }

  /* General DayPicker styling */
  .rdp {
    --rdp-cell-size: 32px; /* Slightly smaller cells */
    --rdp-accent-color: hsl(208, 100%, 50%); /* Use theme primary */
    --rdp-background-color: hsla(208, 100%, 50%, 0.1); /* Subtle selected background */
    --rdp-accent-color-dark: hsl(208, 100%, 45%);
    --rdp-background-color-dark: hsla(208, 100%, 50%, 0.15);
    margin: 0; /* Remove default margin */
    font-size: 0.8rem; /* Smaller base font */
  }
  .rdp-month {
    @apply space-y-1; /* Spacing between weeks */
  }
  .rdp-caption {
    @apply flex justify-center relative items-center h-8 mb-1; /* Caption spacing */
  }
  .rdp-caption_label {
    @apply text-sm font-medium text-gray-700;
  }
  .rdp-nav {
    @apply space-x-1 flex items-center;
  }
  .rdp-nav_button {
    @apply h-7 w-7 bg-transparent p-0 opacity-70 hover:opacity-100 flex items-center justify-center rounded-md hover:bg-black/5 transition-colors;
    @apply focus-visible:ring-1 focus-visible:ring-primary/50 focus-visible:outline-none;
  }
  .rdp-nav_button--prev { @apply absolute left-1; }
  .rdp-nav_button--next { @apply absolute right-1; }

  .rdp-table { @apply w-full border-collapse space-y-1; }
  .rdp-head_row, .rdp-row { @apply flex w-full mt-1; } /* Adjusted spacing */
  .rdp-cell {
    @apply text-center text-sm p-0 relative first:rounded-l-md last:rounded-r-md w-[--rdp-cell-size] h-[--rdp-cell-size] flex items-center justify-center;
    /* Focus ring for keyboard nav */
    &:focus-within:not(.rdp-cell--disabled) {
      @apply ring-1 ring-primary/50 z-10;
    }
  }
  .rdp-head_cell {
    @apply text-muted-foreground rounded-md font-medium text-[0.75rem] w-[--rdp-cell-size]; /* Smaller weekday names */
  }
  .rdp-day {
    @apply h-[--rdp-cell-size] w-[--rdp-cell-size] p-0 font-normal flex items-center justify-center rounded-[5px] text-gray-700; /* Use slightly rounded square */
    @apply transition-colors duration-100 ease-out;
    @apply hover:bg-black/5 aria-selected:opacity-100;
    @apply focus-visible:ring-1 focus-visible:ring-primary/50 focus-visible:outline-none;
  }
  .rdp-day_today {
    @apply font-semibold text-primary bg-primary/5;
  }
  .rdp-day_selected,
  .rdp-day_selected:hover,
  .rdp-day_selected:focus {
    @apply bg-primary text-primary-foreground font-semibold; /* Use defined foreground color */
    /* @apply hover:bg-primary-dark focus:bg-primary; */
  }
  .rdp-day_outside {
    @apply text-muted opacity-50 aria-selected:bg-primary/50 aria-selected:text-muted aria-selected:opacity-30;
    pointer-events: none; /* Prevent interaction */
  }
  .rdp-day_disabled {
    @apply text-muted opacity-50;
    pointer-events: none;
  }

  /* --- End react-day-picker Styles --- */


  /* --- CodeMirror Editor adjustments --- */
  /* Base container for CodeMirror */
  /* Styles like border, bg, rounded should be applied via `className` prop to CodeMirrorEditor */

  /* Focused state for the container */
  .cm-editor-container.focus-within {
    @apply border-primary/80 ring-1 ring-primary/50;
  }

  /* The editor itself */
  .cm-editor {
    @apply text-sm h-full; /* Base text size, fill height */
    &.cm-focused {
      outline: none; /* Remove CodeMirror's default outline, container handles focus */
    }
  }

  /* Scroller within the editor */
  .cm-scroller {
    @apply h-full styled-scrollbar; /* Fill height, use custom scrollbar */
    font-family: var(--font-mono); /* Use monospace font stack */
    line-height: 1.6; /* Improve readability */
  }

  /* Gutters (line numbers, folding) */
  .cm-gutters {
    /* Apply subtle glass effect to gutters */
    @apply bg-glass-inset-200 border-r border-border-color/60 text-muted text-xs opacity-90 pr-2 backdrop-blur-sm;
    user-select: none;
    -webkit-user-select: none;
  }
  /* Highlight for active line number gutter */
  .cm-activeLineGutter {
    @apply bg-primary/10;
  }

  /* Main content area where text is typed */
  .cm-content {
    @apply p-2.5; /* Consistent padding */
    caret-color: hsl(208, 100%, 50%); /* Primary color caret */
  }
  /* Individual lines */
  .cm-line {
    @apply leading-relaxed px-1; /* Add slight horizontal padding to lines */
  }
  /* Placeholder text style */
  .cm-placeholder {
    @apply text-muted italic opacity-70 pointer-events-none absolute top-0 left-0 p-2.5; /* Match content padding */
  }
  /* Text selection style */
  .cm-selectionBackground, ::selection {
    @apply bg-primary/20; /* Subtle primary selection */
  }
  /* Active line background */
  .cm-activeLine {
    background-color: hsla(210, 60%, 95%, 0.6); /* Very subtle active line highlight */
  }
  /* Fold marker (arrow) */
  .cm-foldMarker {
    color: hsl(210, 10%, 65%); /* Muted color */
    margin-left: 2px;
    padding: 0 2px;
    cursor: pointer;
    &:hover {
      color: hsl(210, 10%, 45%); /* Darken on hover */
    }
  }
  /* Gutter element containing the fold marker */
  .cm-foldGutter .cm-gutterElement {
    padding-left: 4px !important; /* Space before fold arrow */
    text-align: center;
  }
}